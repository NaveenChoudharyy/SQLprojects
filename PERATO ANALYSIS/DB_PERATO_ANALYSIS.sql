CREATE DATABASE PERATO_ANALYSIS;

USE PERATO_ANALYSIS;


CREATE TABLE DEFECTS(
DEFECT_NAME VARCHAR(15),
DEFECT_QTY VARCHAR(5))


INSERT INTO DEFECTS VALUES
('DEFECT_1','890'),
('DEFECT_2','720'),
('DEFECT_3','207'),
('DEFECT_4','856'),
('DEFECT_5','810'),
('DEFECT_6','110'),
('DEFECT_7','646'),
('DEFECT_8','456'),
('DEFECT_9','101'),
('DEFECT_10','492');



SELECT * FROM DEFECTS;
D.DEFECT_NAME, D.DEFECT_QTY


WITH CTE AS 
(
SELECT D.DEFECT_NAME, 
ROUND(SUM(CONVERT(INT, D.DEFECT_QTY)) OVER(ORDER BY CONVERT(INT,D.DEFECT_QTY) DESC)*100.0/(SELECT SUM(CONVERT(INT,D.DEFECT_QTY)) FROM DEFECTS AS D),0) AS CUM_FREQ_PERCENT
FROM DEFECTS AS D
)
SELECT DEFECT_NAME, CUM_FREQ_PERCENT FROM CTE
































